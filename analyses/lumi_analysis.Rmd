
---
title: "Pre-reaching infants are sensitive to abstract properties of intentional action"
author: "Shari Liu"
date: "September 22, 2018"
output:
  html_document: default
---

# Tables and Figures

![**Figure 1.** Still frames from videos shown to participants in Experiments 1-5, including stimuli from habituation (A) and test (B). In each video, a person reached for and caused a change in an object (H1-H3, T1-T2), or picked up the object (H4-H5, T3-T4), over a barrier (H1- H2, H4-H5) or over empty space (H2, T1-T4).  The person either acted on the object by contacting it (H1-H2, H4-H5, T1, T3-T4) or produced the same effect from a distance of 50 pixels, after a 0.5s delay (H3, T2), and either performed these actions while wearing a mitten (H1-H4, T1-T3) or with a bare hand (H5, T4) During test (B), the person either reached directly for the object on a novel but efficient trajectory (left panels), or in a curvilinear fashion on the familiar but inefficient trajectory (right panels).](/Users/shariliu/Documents/HarvardLDS/Studies/LUMI/github/analyses/fig1.jpg)

***

```{r setup, include = FALSE}
knitr::opts_chunk$set(comment = "##", echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE, include=FALSE, dependson="lumi_wide")
options(scipen = 0, digits = 3)
## load required packages
ipak <- function (pkg) {
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if (length(new.pkg)) 
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}

# Install devtools package if necessary
if(!"devtools" %in% rownames(installed.packages())) install.packages("devtools")


packages <- c("tidyverse", "Hmisc", "lattice", "multcomp", "lsmeans", "schoRsch", "influence.ME", "devtools", "skimr", "simr", "lme4", "sjPlot", "effects", "lmerTest", "compute.es", "pwr", "stringr", "irr", "predictmeans", "grid", "gridExtra", "ggthemes")

ipak(packages)

```

```{r import}

lumi.wide <- read.csv("/Users/shariliu/Documents/HarvardLDS/Studies/LUMI/github/analyses/lumi_data_deid.csv", header = TRUE) # change to your local directory
lumi.rel <- read.csv("/Users/shariliu/Documents/HarvardLDS/Studies/LUMI/github/analyses/lumi_reliability.csv", header=TRUE)

str(lumi.wide)
```

```{r prep_data}
# convert to long format
lumi.long <- gather(lumi.wide, type, look, ineff.1:avg.eff)
str(lumi.long)
lumi.long$type <- factor(lumi.long$type)
lumi.long$loglook <- log(lumi.long$look)
lumi.long$testpair <- NA
lumi.long$testtype <- NA

# assign test pair and type info to data from individual test trials
for (i in 1:nrow(lumi.long)) {
  if (lumi.long$type[i] == "ineff.1" | lumi.long$type[i] == "prop.ineff1") {
    lumi.long$testtype[i] <- "inefficient"
    lumi.long$testpair[i] <- "first"
  }
  else if (lumi.long$type[i] == "ineff.2" | lumi.long$type[i] == "prop.ineff2") {
    lumi.long$testtype[i] <- "inefficient"
    lumi.long$testpair[i] <- "second"
  }
  else if (lumi.long$type[i] == "ineff.3" | lumi.long$type[i] == "prop.ineff3") {
    lumi.long$testtype[i] <- "inefficient"
    lumi.long$testpair[i] <- "third"
  }
  else if (lumi.long$type[i] == "eff.1") {
    lumi.long$testtype[i] <- "efficient"
    lumi.long$testpair[i] <- "first"
  }
  else if (lumi.long$type[i] == "eff.2") {
    lumi.long$testtype[i] <- "efficient"
    lumi.long$testpair[i] <- "second"
  }
  else if (lumi.long$type[i] == "eff.3") {
    lumi.long$testtype[i] <- "efficient"
    lumi.long$testpair[i] <- "third"
  }
}


# set baseline levels of all categorical predictors for analyses later on
lumi.long$testtype <- factor(lumi.long$testtype)
lumi.long$testtype <- relevel(lumi.long$testtype, ref = "inefficient")
lumi.long$testpair <- factor(lumi.long$testpair)
lumi.long$testpair <- relevel(lumi.long$testpair, ref = "first")
lumi.wide$first.test <- relevel(lumi.wide$first.test, ref = "efficient")
lumi.wide$goal <- relevel(lumi.wide$goal, ref = "pick.up")
lumi.wide$hab <- relevel(lumi.wide$hab, ref = "unconstrained")
lumi.wide$mitten <- relevel(lumi.wide$mitten, ref = "no")
lumi.wide$training <- relevel(lumi.wide$training, ref = "no.training")
lumi.wide$causal <- relevel(lumi.wide$causal, ref = "no")
lumi.wide$sex <- relevel(lumi.wide$sex, ref = "m")
lumi.wide$habbed <- factor(lumi.wide$habbed)
lumi.wide$habbed <- relevel(lumi.wide$habbed, ref = "0")
lumi.wide$pref <- relevel(lumi.wide$pref, ref = "eff")

# section data based on dv
lumi.prop.avg <- filter(lumi.long, type == "prop.ineff.all")
lumi.raw.avg <- filter(lumi.long, type == "avg.eff" | type == "avg.ineff")
lumi.raw.avg$type <- relevel(lumi.raw.avg$type, ref = "avg.ineff")
lumi.prop.tp <- filter(lumi.long, type == "prop.ineff1" | type == "prop.ineff2" | type == "prop.ineff3")
lumi.raw.tp <- filter(lumi.long, type == "ineff.1" | type == "ineff.2" | type == "ineff.3" | type == "eff.1" |type == "eff.2"| type == "eff.3")
```


```{r within_variance}
## Retrieved from : http://www.cookbook-r.com/Graphs/Plotting_means_and_error_bars_(ggplot2)/#error-bars-for-within-subjects-variables
## Gives count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   groupvars: a vector containing names of columns that contain grouping variables
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySE <- function(data=NULL, measurevar, groupvars=NULL, na.rm=FALSE,
                      conf.interval=.95, .drop=TRUE) {
  library(plyr)
  
  # New version of length which can handle NA's: if na.rm==T, don't count them
  length2 <- function (x, na.rm=FALSE) {
    if (na.rm) sum(!is.na(x))
    else       length(x)
  }
  
  # This does the summary. For each group's data frame, return a vector with
  # N, mean, and sd
  datac <- ddply(data, groupvars, .drop=.drop,
                 .fun = function(xx, col) {
                   c(N    = length2(xx[[col]], na.rm=na.rm),
                     mean = mean   (xx[[col]], na.rm=na.rm),
                     sd   = sd     (xx[[col]], na.rm=na.rm)
                   )
                 },
                 measurevar
  )
  
  # Rename the "mean" column    
  datac <- plyr::rename(datac, c("mean" = measurevar))
  
  datac$se <- datac$sd / sqrt(datac$N)  # Calculate standard error of the mean
  
  # Confidence interval multiplier for standard error
  # Calculate t-statistic for confidence interval: 
  # e.g., if conf.interval is .95, use .975 (above/below), and use df=N-1
  ciMult <- qt(conf.interval/2 + .5, datac$N-1)
  datac$ci <- datac$se * ciMult
  
  return(datac)
}
## Norms the data within specified groups in a data frame; it normalizes each
## subject (identified by idvar) so that they have the same mean, within each group
## specified by betweenvars.
##   data: a data frame.
##   idvar: the name of a column that identifies each subject (or matched subjects)
##   measurevar: the name of a column that contains the variable to be summariezed
##   betweenvars: a vector containing names of columns that are between-subjects variables
##   na.rm: a boolean that indicates whether to ignore NA's
normDataWithin <- function(data=NULL, idvar, measurevar, betweenvars=NULL,
                           na.rm=FALSE, .drop=TRUE) {
  library(plyr)
  
  # Measure var on left, idvar + between vars on right of formula.
  data.subjMean <- ddply(data, c(idvar, betweenvars), .drop=.drop,
                         .fun = function(xx, col, na.rm) {
                           c(subjMean = mean(xx[,col], na.rm=na.rm))
                         },
                         measurevar,
                         na.rm
  )
  
  # Put the subject means with original data
  data <- merge(data, data.subjMean)
  
  # Get the normalized data in a new column
  measureNormedVar <- paste(measurevar, "_norm", sep="")
  data[,measureNormedVar] <- data[,measurevar] - data[,"subjMean"] +
    mean(data[,measurevar], na.rm=na.rm)
  
  # Remove this subject mean column
  data$subjMean <- NULL
  
  return(data)
}

## Summarizes data, handling within-subjects variables by removing inter-subject variability.
## It will still work if there are no within-S variables.
## Gives count, un-normed mean, normed mean (with same between-group mean),
##   standard deviation, standard error of the mean, and confidence interval.
## If there are within-subject variables, calculate adjusted values using method from Morey (2008).
##   data: a data frame.
##   measurevar: the name of a column that contains the variable to be summariezed
##   betweenvars: a vector containing names of columns that are between-subjects variables
##   withinvars: a vector containing names of columns that are within-subjects variables
##   idvar: the name of a column that identifies each subject (or matched subjects)
##   na.rm: a boolean that indicates whether to ignore NA's
##   conf.interval: the percent range of the confidence interval (default is 95%)
summarySEwithin <- function(data=NULL, measurevar, betweenvars=NULL, withinvars=NULL,
                            idvar=NULL, na.rm=FALSE, conf.interval=.95, .drop=TRUE) {
  
  # Ensure that the betweenvars and withinvars are factors
  factorvars <- vapply(data[, c(betweenvars, withinvars), drop=FALSE],
                       FUN=is.factor, FUN.VALUE=logical(1))
  
  if (!all(factorvars)) {
    nonfactorvars <- names(factorvars)[!factorvars]
    message("Automatically converting the following non-factors to factors: ",
            paste(nonfactorvars, collapse = ", "))
    data[nonfactorvars] <- lapply(data[nonfactorvars], factor)
  }
  
  # Get the means from the un-normed data
  datac <- summarySE(data, measurevar, groupvars=c(betweenvars, withinvars),
                     na.rm=na.rm, conf.interval=conf.interval, .drop=.drop)
  
  # Drop all the unused columns (these will be calculated with normed data)
  datac$sd <- NULL
  datac$se <- NULL
  datac$ci <- NULL
  
  # Norm each subject's data
  ndata <- normDataWithin(data, idvar, measurevar, betweenvars, na.rm, .drop=.drop)
  
  # This is the name of the new column
  measurevar_n <- paste(measurevar, "_norm", sep="")
  
  # Collapse the normed data - now we can treat between and within vars the same
  ndatac <- summarySE(ndata, measurevar_n, groupvars=c(betweenvars, withinvars),
                      na.rm=na.rm, conf.interval=conf.interval, .drop=.drop)
  
  # Apply correction from Morey (2008) to the standard error and confidence interval
  #  Get the product of the number of conditions of within-S variables
  nWithinGroups    <- prod(vapply(ndatac[,withinvars, drop=FALSE], FUN=nlevels,
                                  FUN.VALUE=numeric(1)))
  correctionFactor <- sqrt( nWithinGroups / (nWithinGroups-1) )
  
  # Apply the correction factor
  ndatac$sd <- ndatac$sd * correctionFactor
  ndatac$se <- ndatac$se * correctionFactor
  ndatac$ci <- ndatac$ci * correctionFactor
  
  # Combine the un-normed means with the normed results
  merge(datac, ndatac)
}


## get within-subjects CIs for plotting
summary.avg <- summarySEwithin(data = dplyr::filter(lumi.raw.avg), measurevar = "look", betweenvars = c("experiment", "training", "hab","goal","mitten","causal", "paper"), withinvars = "type",
                                  idvar = "subj_id")
kable(summary.avg, caption = "Summary of Avg Looks to Eff and Ineff Actions")

prop.tp <- summarySEwithin(data = dplyr::filter(lumi.prop.tp), measurevar = "look", betweenvars = c("experiment", "training", "hab","goal","mitten","causal", "paper"), withinvars = "testpair",
                                   idvar = "subj_id")
prop.tp


```

```{r fig2a, fig.width = 20, include=TRUE}

# avg looks to eff and ineff, grouped by experiment, with full variable info 
fig2.raw <- ggplot(data = dplyr::filter(lumi.raw.avg), aes(type, look, fill=experiment))
fig2.raw.LBS <- ggplot(data = dplyr::filter(lumi.raw.avg, paper == "LBS"), aes(type, look, fill=experiment))
fig2.raw.full <- fig2.raw.LBS +
  geom_boxplot(outlier.colour = NA, alpha = 0.5)+
  stat_summary(fun.y = mean, geom = "point", shape=21, size=3, position = "dodge", colour = "black", fill = "white") +
  ylab("\n \n \n \n \n \n \n Looking Time (s)") +
  xlab("Test Event")+
  coord_cartesian(ylim = c(0, 40)) +
  geom_point(alpha = 0.1)+
  geom_line(alpha = 0.1, aes(group = subj_id))+
  geom_errorbar(data = filter(summary.avg, paper == "LBS"), size = 1, width = 0, colour = "red", aes(ymin=look-ci, ymax=look+ci)) +
  facet_grid(~experiment+goal+hab+causal+mitten)+
  scale_x_discrete(labels = c("ineff","eff"))+
  theme_bw(14)+
  scale_fill_ptol()+
  theme(legend.position="none", strip.text.x = element_blank())

fig2.raw.full


```

```{r fig2b, fig.width = 20, fig.height=11, include=TRUE}
# prop looks ineff, grouped by experiment, with full variable info 
fig2.prop <- ggplot(data = dplyr::filter(lumi.prop.avg), aes(testtype, look, fill=experiment))
fig2.prop.LBS <- ggplot(data = dplyr::filter(lumi.prop.avg, paper == "LBS"), aes(testtype, look, fill=experiment))
fig2.prop.full <- fig2.prop.LBS + 
  geom_boxplot(alpha = 0.5)+
  geom_violin(fill = NA, width = 0.5)+
  stat_summary(fun.y = mean, geom = "point", shape =21, size=3, position = "dodge", colour = "black", fill = "white") +
  ylab("\n \n \n \n \n \n Proportion Looking \n to Inefficient") +
  xlab(element_blank())+
  geom_jitter(width = .05, alpha = 0.2)+
  coord_cartesian(ylim = c(0.2,0.8)) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", colour="red", position = position_dodge(width = 5), width = 0, size = 1) +
  geom_hline(yintercept=0.5, alpha=0.4)+
  facet_grid(~experiment+goal+hab+causal+mitten+stimuli)+
  theme_bw(14)+
  scale_fill_ptol()+
  theme(strip.placement = "outside") +
  theme(legend.position="none", axis.text.x = element_blank(), axis.title.x=element_blank())

# add annotations

grid.arrange(fig2.prop.full, fig2.raw.full, heights = c(0.5,0.5))

# grid.text("Experiment", x = 0.05, y = 0.978)
# grid.text("Training", x = 0.05, y = .95)
# grid.text("Goal", x = 0.05, y = 0.89)
# grid.text("Habituation", x = 0.05, y = .92)
# grid.text("Causal", x = 0.05, y = 0.861)
# grid.text("Mitten", x = 0.05, y = 0.832)
# grid.text("Stimuli", x = 0.05, y = 0.805)

grid.text("Experiment", x = 0.1, y = 0.97)
grid.text("Goal", x = 0.1, y = 0.94)
grid.text("Action relative to barrier", x = 0.1, y = 0.91)
grid.text("Action on contact", x = 0.1, y = 0.88)
grid.text("Actor wearing mitten", x = 0.1, y = 0.85)
grid.text("Displays", x = 0.1, y = 0.82)

```

**Figure 2.** Looking time in seconds towards the efficient versus inefficient reach (bottom), and proportion looking towards the inefficient reach (top) at test across Experiments 1-5 (N=152). Labels above each panel list the experiment name (Exp. 1-5), whether actions during habituation were constrained or unconstrained by a barrier, goal (state.change or pick.up), whether these actions involved contact with the object, whether the actor wore a mitten, and video displays listed in Figure 1. Error bars around means indicate within-subjects 95% confidence intervals (bottom) and bootstrapped 95% confidence intervals (top). Individual points (top) or pairs of connected points (bottom) indicate data from a single participant. Horizontal bars within boxes indicate medians, and boxes indicate the middle 2 quartiles of data. Violin plots (top) indicate distribution of data, area scaled proportionally to the number of observations.


***



```{r analysis_prep}
exp1.avg <-dplyr::filter(lumi.raw.avg, experiment == "Exp.1")
exp2.avg <-dplyr::filter(lumi.raw.avg, experiment == "Exp.2")
exp3.avg <-dplyr::filter(lumi.raw.avg, experiment == "Exp.3")
exp4.avg <-dplyr::filter(lumi.raw.avg, experiment == "Exp.4")
exp5.avg <-dplyr::filter(lumi.raw.avg, experiment == "Exp.5")
exp45.avg <-dplyr::filter(lumi.raw.avg, experiment == "Exp.4" | experiment == "Exp.5")
op <- options(contrasts = c("contr.treatment", "contr.poly")) # treatment contrasts

# function that returns column of standardized betas from lmer model
gen.beta <- function(model) {
  return(t(fixef(model)))
}

# function that computes CIs and returns them in df
gen.ci <- function(model) {
  df <- data.frame(confint(model))
  names(df) <- c("lower", "upper")
  return(df)
}

# function that converts model summary (lmer) to df
gen.m <- function(model) {
  df <- data.frame(coef(summary(model)))
  names(df) <- c("est", "se", "df", "t", "p")
  return(df)
}

# function that converts model summary (lm) to df
gen.lm <- function(model) {
  df <- data.frame(coef(summary(model)))
  names(df) <- c("est", "se", "t", "p")
  return(df)
}

# function that returns age info and number of females in a dataset
ages <- function(longdata) {
  longdata %>% summarize(mean = mean(ageday), min=range(ageday)[1], max=range(ageday)[2], f=sum(sex=="f")/2)
}

# function that returns formatted result from lme4/lmerTest table
report <- function(table, index, places, tails) {
  if (tails == "1") {
    p <- round(table$p[index], places)/2
    howmanytails <- "one-tailed"
  } else {
    p <- round(table$p[index], places)
    howmanytails <- "two-tailed"
  }
  if (p < .001) {
    p <- "<.001"
  } else {
    p <- paste("=", round(p,places), sep = "")
  }
  result <- paste("[", round(table$lower[index], places), ",", round(table$upper[index], places), "], ß=", round(table$beta[index], places), ", B=", round(table$b[index],places), ", SE=", round(table$se[index],places), " p", p, ", ", howmanytails, sep = "")
  return(result)
}
```


# Results (Main Text)
## Infants' analysis of causal vs non-causal actions
### Experiment 1
```{r exp1}
# participant info
exp1.info <- ages(exp1.avg)
exp.info <- ages(filter(lumi.raw.avg, paper == "LBS"))

# null model
model0.exp1 <- lmer(formula = loglook ~ 1 + (1|subj_id),
               data = exp1.avg, REML = FALSE)

# hypothesis-driven model
model1.exp1 <- lmer(formula = loglook ~ type * hab + (1|subj_id),
               data = exp1.avg, REML = FALSE)
model1.exp1.table <- gen.m(model1.exp1)
model1.exp1.ci <- gen.ci(model1.exp1)[3:6,]

# identify and check influence of observations
plot(influence(model1.exp1, "subj_id"), which="cook",
     cutoff=4/40, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")
# 2 detected!

# generate results without these influential subjects
model1.exp1.cooks <- lmer(formula = loglook ~ type * hab + (1|subj_id),
               data = filter(exp1.avg, subj_id != "S1_6" & subj_id != "S1_25"), REML = FALSE)
model1.exp1.table <- gen.m(model1.exp1.cooks)
model1.exp1.ci <- gen.ci(model1.exp1.cooks)[3:6,]

# standardized values
model1.exp1.beta <- lmer(formula = scale(loglook) ~ type * hab + (1|subj_id),
               data = filter(exp1.avg, subj_id != "S1_6" & subj_id != "S1_25"), REML = FALSE)
model1.exp1.betas <- fixef(model1.exp1.beta)

# look at contrasts within each habituation condition
contrasts.exp1 <- cbind(difflsmeans(model1.exp1.beta, test.effs="type:hab")[[1]][,1], difflsmeans(model1.exp1.cooks, test.effs="type:hab")[[1]])
names(contrasts.exp1) <- c("beta", "b", "se", "df", "t", "lower", "upper", "p")

```

```{r exp1.table}
exp1 <- kable(cbind(model1.exp1.betas,model1.exp1.table,model1.exp1.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp1.findings <- data.frame(cbind(model1.exp1.betas,model1.exp1.table,model1.exp1.ci))
names(exp1.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")

```


In Experiment 1, infants (N=`r length(unique(exp1.avg$subj_id))`; `r length(unique(exp1.avg$subj_id))/2` per condition; Mean age=`r round(exp1.info$mean,0)` days; range=`r exp1.info$min`-`r exp1.info$max`, `r exp1.info$f` female) were habituated to and tested on video clips where a person reached for an object, and caused it to illuminate by touching it (Figure 1) while we measured their looking times. First, we randomly assigned infants to one of two habituation conditions: In the constrained condition, infants watched the person reach over a barrier that prevented direct access to the object (Figure 1A, H1), and in the unconstrained condition, infants watched the person perform the same reaches with the barrier behind the goal object, out of the actor’s way (H2) (an action that appears to adults and older infants to be inefficient (36)). After infants habituated to these events (i.e. their attention declined by 50%), or after 12 trials, whichever came first, we measured their attention to alternating test events (Figure 1B, T1). During test, the person either reached on the same curvilinear path towards the object (a familiar but newly inefficient action) or on a direct path (a novel but newly efficient action). For methodological details, see SM. Across all experiments, we calculated the average looking time towards the efficient versus inefficient reach over 3 pairs of test events. Infant looking times are often log-normally distributed (37), including in this dataset (see Figure S3) and thus were log-transformed (main results) or transformed to proportions (meta-analysis, see SM) prior to analysis. If prereaching infants view reaching actions as constrained by barriers and expect them to be efficient, then those in the constrained condition should look longer, at test, when the actor reached on the superficially familiar but inefficient curvilinear trajectory. Figure 1. Still frames from videos shown to participants in Experiments 1-5, including stimuli from habituation (A) and test (B). In each video, a person reached for and caused a change in an object (H1-H3, T1-T2), or picked up the object (H4-H5, T3-T4), over a barrier (H1- H2, H4-H5) or over empty space (H2, T1-T4).  The person either acted on the object by contacting it (H1-H2, H4-H5, T1, T3-T4) or produced the same effect from a distance of 50 pixels, after a 0.5s delay (H3, T2), and either performed these actions while wearing a mitten (H1-H4, T1-T3) or with a bare hand (H5, T4) During test (B), the person either reached directly for the object on a novel but efficient trajectory (left panels), or in a curvilinear fashion on the familiar but inefficient trajectory (right panels). All videos are open source and available at https://osf.io/fe4wj/.


Infants responded differently to the test events across the two habituation conditions (`r report(exp1.findings, 4, 3, 2)`, 2 participants excluded on the basis of Cook’s Distance (38), mixed effects model with habituation condition and test event as a fixed interaction, participant identity as a random intercept). When the actor’s reaches were initially constrained by a barrier (H1), infants looked longer, at test, at the inefficient action than the efficient action (Mean~ineff~=`r summary.avg$look[2]`s, Mean~eff~=`r summary.avg$look[1]`s, `r report(contrasts.exp1, 2, 3, 2)`). Critically, this looking preference cannot be attributed to low-level preferences for the curvilinear reach, because infants in the unconstrained condition (H2) showed a preference for the efficient over the inefficient action (M~ineff~=`r summary.avg$look[4]`s, M~eff~=`r summary.avg$look[3]`s, `r report(contrasts.exp1, 6, 3, 2)`). See Figure 2. Experiment 1 therefore provides evidence that infants expect object-directed reaches to be efficient. 



### Experiment 2
```{r exp2}
# participant info
exp2.info <- ages(exp2.avg)

# null model
model0.exp2 <- lmer(formula = loglook ~ 1 + (1|subj_id),
               data = exp2.avg, REML = FALSE)

# hypothesis-driven model
model1.exp2 <- lmer(formula = loglook ~ type + (1|subj_id),
               data = exp2.avg, REML = FALSE)
model1.exp2.table <- data.frame(coef(summary(model1.exp2)))
model1.exp2.ci <- gen.ci(model1.exp2)[3:4,]

# standardized values
model1.exp2.beta <- lmer(formula = scale(loglook) ~ type + (1|subj_id),
                         data = exp2.avg, REML = FALSE)
model1.exp2.betas <- fixef(model1.exp2.beta)

# identify and check influence of observations
# model.exp2.cooks <- exclude.cooks(model1.exp2, exp2.avg, "subj_id")
plot(influence(model1.exp2, "subj_id"), which="cook",
     cutoff=4/20, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")
# no influential observations

# comparing results to Exp 1
causality12 <- lumi.raw.avg %>%
  filter(experiment == 'Exp.1' | experiment == "Exp.2") %>%
  filter(hab == "constrained")

model1.exp12 <- lmer(formula = loglook ~ type * causal + (1|subj_id) + (1|experiment),
                     data = causality12, REML=FALSE)
model1.exp12.table <- data.frame(coef(summary(model1.exp12)))
model1.exp12.ci <- gen.ci(model1.exp12)[4:7,]

# checking for influential observations - none found
plot(influence(model1.exp12, "subj_id"), which="cook",
     cutoff=4/40, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")

# standardized betas
model1.exp12 <- lmer(formula = scale(loglook) ~ type * causal + (1|subj_id) + (1|experiment),
                     data = causality12, REML=FALSE)
model1.exp12.betas <- fixef(model1.exp12)

# look at contrasts within each caual condition
contrasts.exp12 <- difflsmeans(model1.exp12, test.effs="type:causal")[[1]]
names(contrasts.exp12) <- str_replace_all(names(contrasts.exp12), ' ', '') # rename to fix issue with ` and - in Rmd
names(contrasts.exp12) <- str_replace_all(names(contrasts.exp12), '-', '')
```


```{r exp2.table}
exp2 <- kable(cbind(model1.exp2.betas,model1.exp2.table,model1.exp2.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp2.findings <- data.frame(cbind(model1.exp2.betas,model1.exp2.table,model1.exp2.ci))
names(exp2.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
```

```{r exp12.table}
exp12 <- kable(cbind(model1.exp12.betas,model1.exp12.table,model1.exp12.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp12.findings <- data.frame(cbind(model1.exp12.betas,model1.exp12.table,model1.exp12.ci))
names(exp12.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
```


In Experiment 2, pre-registered at https://osf.io/a5byn/, we tested whether this expectation depends on infants’ construal of the actor as a causal agent, who intends to change the state of the object on contact. We did this by introducing digital manipulations that abolish causal perception in older infants and adults (7–9, 39, 40) to the habituation and test events from Experiment 1. Infants (N=`r length(unique(exp2.avg$subj_id))`; Mean age=`r round(exp2.info$mean,0)` days; range=`r exp2.info$min`-`r exp2.info$max`; `r exp2.info$f` female) saw videos identical to those from the constrained condition of Experiment 1, except that person’s hand never contacted the object (stopping 50 pixels, or 2 cm above it), and the object changed state after a 0.5 second delay (H3, T2). In contrast to Experiment 1, infants looked equally at test trials showing the inefficient and efficient actions (M~ineff~=`r summary.avg$look[6]`s, M~eff~=`r summary.avg$look[5]`s, `r report(exp2.findings, 2, 3, 2)`, mixed effects model with test event as fixed effect and participants as a random intercept). Across Experiments 1 (H1, T1) and 2 (H3, T2), infants responded differently to the test events depending on whether the person acted on the object on contact  (`r report(exp12.findings, 4, 3, 2)`, mixed effects model with fixed interaction between causal intention and test event and participants as a random intercept). These findings suggest that infants expect others’ actions to be efficient if and only if these actions are guided by causal intentions. 

### Experiment 3
```{r exp3}
# participant info
exp3.info <- ages(exp3.avg)

# null model
model0.exp3 <- lmer(formula = loglook ~ 1 + (1|subj_id),
               data = exp3.avg, REML = FALSE)

model1.exp3 <- lmer(formula = loglook ~ type * causal + (1|subj_id),
                     data = exp3.avg, REML=FALSE)
model1.exp3.table <- data.frame(coef(summary(model1.exp3)))
model1.exp3.ci <- gen.ci(model1.exp3)[3:6,]

# standardized values
model1.exp3.beta <- lmer(formula = scale(loglook) ~ type * causal + (1|subj_id),
                     data = exp3.avg, REML=FALSE)
model1.exp3.betas <- fixef(model1.exp3.beta)

# identify and check influence of observations
# model.exp3.cooks <- exclude.cooks(model1.exp3, exp3.avg, exp3.avg$subj_id)
plot(influence(model1.exp3, "subj_id"), which="cook",
     cutoff=4/52, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")
# no influential observations

# look at contrasts within each caual condition
contrasts.exp3 <- cbind(difflsmeans(model1.exp3.beta, test.effs="type:causal")[[1]][,1], difflsmeans(model1.exp3, test.effs="type:causal")[[1]])
names(contrasts.exp3) <- c("beta", "b", "se", "df", "t", "lower", "upper", "p")
```

```{r exp3.table}
exp3 <- kable(cbind(model1.exp3.betas,model1.exp3.table,model1.exp3.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp3.findings <- data.frame(cbind(model1.exp3.betas,model1.exp3.table,model1.exp3.ci))
names(exp3.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
```


To evaluate this suggestion further, we conducted a direct replication of Experiments 1 and 2. In Experiment 3 pre-registered at https://osf.io/f2hvd/, we randomly assigned infants (N=`r length(unique(exp3.avg$subj_id))`, `r length(unique(exp3.avg$subj_id))/2` per condition; Mean age=`r round(exp3.info$mean,0)` days; range=`r exp3.info$min`-`r exp3.info$max`; `r exp3.info$f` female) to events that differed by causal intention alone. This design allowed us to compare infants’ expectations about efficiency to causal (H1, T1) vs non-causal (H3, H2) actions, under testing conditions where all researchers were blind to condition as well as test events. We fully replicated the findings from Experiments 1-2: Infants again responded to the test events differently depending on whether the person’s hand contacted the object at the time of the object’s state change (`r report(exp3.findings, 4, 3, 2)`, mixed effects model with fixed interaction of causality and test event and random intercept for participants). As in Experiment 1, infants looked longer at the inefficient than the efficient reach when the person appeared to intentionally cause a change in the object, (M~ineff~=`r summary.avg$look[10]`s, M~eff~=`r summary.avg$look[9]`s, `r report(contrasts.exp3, 6, 3, 1)`), and as in Experiment 2, infants looked equally to the inefficient and efficient reaches when she did not appear to cause this outcome (M~ineff~=`r summary.avg$look[8]`s, M~eff~=`r summary.avg$look[7]`s, `r report(contrasts.exp3, 1, 3, 1)`). Although 3-month-old infants have limited experience acting as causal agents themselves, they understand that other people intend to cause a change in the world through their actions, and tend to do so efficiently. 


## Infants’ analysis of entrainment actions
### Experiments 4 and 5
```{r exp45}
# participant info
exp4.info <- ages(exp4.avg)
exp5.info <- ages(exp5.avg)

# null model
model0.exp45 <- lmer(formula = loglook ~ 1 + (1|subj_id) + (1|experiment),
               data = exp45.avg, REML = FALSE)

model1.exp45 <- lmer(formula = loglook ~ type + (1|subj_id) + (1|experiment),
                     data = exp45.avg, REML=FALSE)

# identify and check influence of observations
plot(influence(model1.exp45, "subj_id"), which="cook",
     cutoff=4/40, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")

# 3 influential observations identified
model1.exp45.cooks <- lmer(formula = loglook ~ type * mitten + (1|subj_id) + (1|experiment),
                     data = filter(exp45.avg, subj_id != "S4_9" & subj_id != "S5_10" & subj_id != "S5_7"), REML=FALSE)
model1.exp45.table <- gen.m(model1.exp45.cooks)
model1.exp45.ci <- gen.ci(model1.exp45.cooks)[4:7,]

# standardized values
model1.exp45.beta <- lmer(formula = scale(loglook) ~ type * mitten + (1|subj_id) + (1|experiment),
                     data = filter(exp45.avg, subj_id != "S4_9" & subj_id != "S5_10" & subj_id != "S5_7"), REML=FALSE)
model1.exp45.betas <- fixef(model1.exp45.beta)

# look at contrasts within each habituation condition
contrasts.exp45 <- cbind(difflsmeans(model1.exp45.beta, test.effs="type:mitten")[[1]][,1], difflsmeans(model1.exp45.cooks, test.effs="type:mitten")[[1]])
names(contrasts.exp45) <- c("beta", "b", "se", "df", "t", "lower", "upper", "p")
```


```{r exp45.table}
exp45 <- kable(cbind(model1.exp45.betas,model1.exp45.table,model1.exp45.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp45.findings <- data.frame(cbind(model1.exp45.betas,model1.exp45.table,model1.exp45.ci))
names(exp45.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
```


```{r exp5.scs}
exp5.scs <- lumi.raw.avg %>% filter(experiment == "Exp.5" | experiment == "SCS.Exp.3")

# null model
model0.exp5.scs <- lmer(formula = loglook ~ 1 + (1|subj_id) + (1|experiment),
               data = exp5.scs, REML = FALSE)

model1.exp5.scs <- lmer(formula = loglook ~ type * mitten + (1|subj_id) + (1|experiment),
                     data = exp5.scs, REML=FALSE)

# identify and check influence of observations
plot(influence(model1.exp5.scs, "subj_id"), which="cook",
     cutoff=4/40, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")
# one identified

model1.exp5.scs.cooks <- lmer(formula = loglook ~ type * mitten + (1|subj_id) + (1|experiment),
                     data = filter(exp5.scs, subj_id != "SCS_S3_12"), REML=FALSE)
model1.exp5.scs.table <- gen.m(model1.exp5.scs.cooks)
model1.exp5.scs.ci <- gen.ci(model1.exp5.scs.cooks)[4:7,]

# standardized values
model1.exp5.scs.beta <- lmer(formula = scale(loglook) ~ type * mitten + (1|subj_id) + (1|experiment),
                     data = filter(exp5.scs, subj_id != "SCS_S3_12"), REML=FALSE)
model1.exp5.scs.betas <- fixef(model1.exp5.scs.beta)
             
# look at contrasts within each caual condition
contrasts.exp5.scs <- cbind(difflsmeans(model1.exp5.scs.beta, test.effs="type:mitten")[[1]][,1], difflsmeans(model1.exp5.scs.cooks, test.effs="type:mitten")[[1]])
names(contrasts.exp5.scs) <- c("beta", "b", "se", "df", "t", "lower", "upper", "p")
```


```{r exp5.scs.table}
exp5.scs <- kable(cbind(model1.exp5.scs.betas,model1.exp5.scs.table,model1.exp5.scs.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp5.scs.findings <- data.frame(cbind(model1.exp5.scs.betas,model1.exp5.scs.table,model1.exp5.scs.ci))
names(exp5.scs.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
```


```{r exp4.scs}
exp4.scs <- lumi.raw.avg %>% filter(experiment == "Exp.4" | experiment == "SCS.Exp.3")

# null model
model0.exp4.scs <- lmer(formula = loglook ~ 1 + (1|subj_id) + (1|experiment),
               data = exp4.scs, REML = FALSE)

model1.exp4.scs <- lmer(formula = loglook ~ type * experiment + (1|subj_id) + (1|experiment),
                     data = exp4.scs, REML=FALSE)

# identify and check influence of observations
plot(influence(model1.exp4.scs, "subj_id"), which="cook",
     cutoff=4/40, sort=TRUE,
     xlab="Cook´s Distance",
     ylab="Subject ID")
# 2 subjects identified

model1.exp4.scs.cooks <- lmer(formula = loglook ~ type * experiment + (1|subj_id) + (1|experiment),
                     data = filter(exp4.scs, subj_id != "SCS_S3_12" & subj_id != "S4_9"), REML=FALSE)
model1.exp4.scs.table <- gen.m(model1.exp4.scs.cooks) 
model1.exp4.scs.ci <-  gen.ci(model1.exp4.scs.cooks)[4:7,]

# standardized values
model1.exp4.scs.beta <- lmer(formula = scale(loglook) ~ type * experiment + (1|subj_id) + (1|experiment),
                     data = filter(exp4.scs, subj_id != "SCS_S3_12" & subj_id != "S4_9"), REML=FALSE)
model1.exp4.scs.betas <- fixef(model1.exp4.scs.beta)

# look at contrasts within each experiment
contrasts.exp4.scs <- cbind(difflsmeans(model1.exp4.scs.beta, test.effs="type:experiment")[[1]][,1], difflsmeans(model1.exp4.scs.cooks, test.effs="type:experiment")[[1]])
names(contrasts.exp5.scs) <- c("beta", "b", "se", "df", "t", "lower", "upper", "p")
```

```{r exp4.scs.table}
exp4.scs <- kable(cbind(model1.exp4.scs.betas,model1.exp4.scs.table,model1.exp4.scs.ci), col.names = c("beta", "b", "se", "df", "t", "p", "lower", "upper"))

exp4.scs.findings <- data.frame(cbind(model1.exp4.scs.betas,model1.exp4.scs.table,model1.exp4.scs.ci))
names(exp4.scs.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
```


In Experiment 4, we habituated and tested infants (N=`r length(unique(exp4.avg$subj_id))`; Mean age=`r round(exp4.info$mean,0)` days; range=`r exp4.info$min`-`r exp4.info$max`, `r exp4.info$f` female) using events in which a person reached for, picked up, and displaced an object while wearing a mitten (H4, T3), as in prior research (28). In Experiment 5, infants (N=`r length(unique(exp5.avg$subj_id))`; Mean age=`r round(exp5.info$mean,0)` days; range=`r exp5.info$min`-`r exp5.info$max`; `r exp5.info$f` female) saw almost identical videos except that the person reached with a bare hand (H5, T4). If infants need first-person action experience to understand acts of picking up and displacing objects, then they should fail in both conditions. If they understand that hands cause changes in objects on contact, as Experiments 1-3 and computational studies (41) suggest, then they might succeed in these experiments, especially in the more familiar bare-handed condition. We found that infants looked longer at the inefficient than the efficient reach of the bare hand in Experiment 5 (M~ineff~=`r summary.avg$look[14]`s, M~eff~=`r summary.avg$look[13]`s, `r report(contrasts.exp45, 1, 3, 1)`), but they looked equally to the inefficient and the efficient reach of the mittened hand in Experiment 4 (M~ineff~=`r summary.avg$look[12]`s, M~eff~=`r summary.avg$look[11]`s, `r report(contrasts.exp45, 6, 3, 1)`).  However, infants’ expectations in Experiments 4 and 5 did not differ from each other (`r report(exp45.findings, 4, 3, 2)`, mixed effects model with fixed interaction between mitten and test event, random intercept for participants, excluding 3 influential participants on the basis of Cook’s Distance). Thus, Experiment 5 provides evidence that infants expect barehanded reaching and lifting of an object to be efficient, but differences in infants’ responses to gloved and ungloved hands are not clear.


## Comparing state change and entrainment actions


```{r meta}
# set contrasts for analysis - compare effects against the grand mean
op <- options(contrasts = c("contr.sum", "contr.poly"))

# strangely, we need to flip reference levels so that ref gets compred against grand mean
lumi.wide$goal <- relevel(lumi.wide$goal, ref = "state.change")
lumi.wide$hab <- relevel(lumi.wide$hab, ref = "constrained")
lumi.wide$mitten <- relevel(lumi.wide$mitten, ref = "yes")
lumi.wide$training <- factor(lumi.wide$training, levels = c("effective.training", "ineffective.training", "no.training"))
lumi.wide$causal <- relevel(lumi.wide$causal, ref = "yes")

# full exploratory model
model1.all <- lmer(formula = prop.ineff.all ~ training + goal + hab + causal + mitten + (1|experiment) + (1|ageday) + (1|sex) + (1|paper), data = lumi.wide)

# identify and check influence of observations
meta.influence <- CookD(model1.all, plot=FALSE) # influential 
meta.exclude.n <- length(which(meta.influence > 4/264)) # how many subj exceeded cutoff?

model1.all.cooks <- lmer(formula = prop.ineff.all ~ training + goal + hab + causal + mitten + (1|experiment) + (1|ageday) + (1|sex) + (1|paper), data = lumi.wide %>% slice(which(meta.influence < 4/264)))
model1.all.table <- gen.m(model1.all.cooks)
model1.all.ci <- gen.ci(model1.all.cooks)[6:12,]

# standardized values
model1.all.beta <- lmer(formula = scale(prop.ineff.all) ~ training + goal + hab + causal + mitten + (1|experiment) + (1|ageday) + (1|sex) + (1|paper), data = lumi.wide %>% slice(which(meta.influence < 4/264)))
model1.all.betas <- fixef(model1.all.beta)


meta.findings <- data.frame(cbind(model1.all.betas, model1.all.table, model1.all.ci))
names(meta.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")
rownames(meta.findings) <- c("(Intercept)", "effective training", "ineffective training", "state change goal", "constrained habituation", "causally effective", "mitten")

```

To explore these effects further and compare them to past research (28), we performed a meta-analysis over the ten experiments (Experiments 1-5, and all experiments from Skerry et al. (28)) that used the present paradigm with 3-month-old infants (total N=`r length(unique(lumi.raw.avg$subj_id))`) (Fig. S1). As shown in past training studies (22, 28, 30, 42), action understanding was more robust after training, relative to no training (`r report(meta.findings, 2, 3, 2)`). Infants also held stronger expectations for efficient reaching when the actor simply touched an object and caused a change in its state, as in Experiments 1-3, than when she lifted and displaced the object, as in Experiments 4-5 and all experiments in Skerry et al. (28) (`r report(meta.findings, 4, 3, 2)`).  Knowledge of the causal intentions and costs underlying reaching actions therefore arises without training, but is more robust if actions are causally transparent or if infants receive action training. For full meta-analytic methods and results, see SM. 


## Reliability (Methods Section)
```{r reliability}
exp1.rel <- icc(cbind(filter(lumi.rel, experiment == "Exp.1")$newlook, filter(lumi.rel, experiment == "Exp.1")$look.orig), model = "twoway", type = "agreement", unit = "single")
exp2.rel <- icc(cbind(filter(lumi.rel, experiment == "Exp.2")$newlook, filter(lumi.rel, experiment == "Exp.2")$look.orig), model = "twoway", type = "agreement", unit = "single")
exp3.rel <- icc(cbind(filter(lumi.rel, experiment == "Exp.3")$newlook, filter(lumi.rel, experiment == "Exp.3")$look.orig), model = "twoway", type = "agreement", unit = "single")
exp4.rel <- icc(cbind(filter(lumi.rel, experiment == "Exp.4")$newlook, filter(lumi.rel, experiment == "Exp.4")$look.orig), model = "twoway", type = "agreement", unit = "single")
exp5.rel <- icc(cbind(filter(lumi.rel, experiment == "Exp.5")$newlook, filter(lumi.rel, experiment == "Exp.5")$look.orig), model = "twoway", type = "agreement", unit = "single")

```


To assess reliability, 50% of test trials from participants across Experiments 1-5 (`r length(unique(lumi.wide$subj_id))/2` participants, `r nrow(lumi.rel)` trials) were randomly selected and coded by additional researchers who were unaware of experimental condition, and test trial order. The intraclass correlation coefficient (ICC) between the original data, and this newly coded data, was `r exp1.rel$value` [`r exp1.rel$lbound`, `r exp1.rel$ubound`], `r exp2.rel$value` [`r exp2.rel$lbound`, `r exp2.rel$ubound`], `r exp3.rel$value` [`r exp3.rel$lbound`, `r exp3.rel$ubound`], `r exp4.rel$value` [`r exp4.rel$lbound`, `r exp4.rel$ubound`], `r exp5.rel$value` [`r exp5.rel$lbound`, `r exp5.rel$ubound`], for Experiments 1 through 5, respectively.


# Supplemental Results

## Comparing Experiments 4-5 with Skerry et al. (2013)

We compared the results of Experiment 4 and 5 against those from Skerry et al’s Experiment 3, wherein infants received no mittens training and viewed a person reaching with a mittened hand. The results of Experiment 5 (no mitten) differed from those of the earlier experiment (mitten), `r report(exp5.scs.findings, 4, 3, 2)`, mixed effects model with fixed interaction between experiment and test event and random intercept for participants, one influential participant excluded on the basis of Cook’s Distance. In addition, the results from Experiment 4 (mitten) marginally differed from those in of Skerry et al. (mitten),  `r report(exp4.scs.findings, 4, 3, 2)`, mixed effects model with fixed interaction between experiment and test events and random intercept for participants, 2 influential participants excluded on the basis of Cook's Distance. 


## Meta-analytic results

To assess the unique effects of our experimental manipulations in Experiments 1-5 and in Skerry et al. (28), we performed an analysis over these two papers (total N=`r length(unique(lumi.raw.avg$subj_id))`, 12 conditions). Our analytic approach allows us to assess the independent effects of 5 manipulations: the type of or absence of motor training, the presence or absence of barrier preventing a direct reach for the object during habituation, the nature of the goal (to change the state of an object or pick it up), the presence or absence of action on contact, and the presence of absence of mittens on the actor. The analysis also allows us to control for the participant variables age and sex, and model the nested structure of the data (e.g. looks clustered within experiments and within papers). For ease of interpretation, we used average proportion looking to the inefficient action in this analysis, following Skerry et al. (28)). 

This analysis confirmed the findings from the individual experiments reported in the main text and in Skerry et al. (28):  Infants’ expectations were stronger when the observed action was spatiotemporally continuous with its effect (i.e., appeared to be causal),  `r report(meta.findings, 6, 3, 2)`, when infants received effective motor training (sticky mittens), relative to no training `r report(meta.findings, 2, 3, 2)`, when the observed agent's actions were constrained by a barrier and were efficiently adapted to that barrier, relative to the same actions that were unconstrained by a barrier, `r report(meta.findings, 5, 3, 2)`, and when the agent pursued a state change goal, relative to a pickup goal, `r report(meta.findings, 4, 3, 2)`. We also found that infants’ expectations were marginally *negatively* affected when they received ineffective motor training (non-sticky mittens), relative to no training, `r report(meta.findings, 3, 3, 2)`, and were unaffected when the actor wore a mitten, relative to no mitten `r report(meta.findings, 7, 3, 2)`, as reported in the main text. These findings provide further evidence that action experience alters action interpretation, for good or for ill, but so does causal information and information about efficiency.

```{r figS1a, fig.width = 20, include=TRUE}

# avg looks to eff and ineff, grouped by experiment, with full variable info 
figS1.raw <- ggplot(data = dplyr::filter(lumi.raw.avg), aes(type, look, fill=experiment))
figS1.raw.full <- figS1.raw +
  geom_boxplot(outlier.colour = NA, alpha = 0.5)+
  stat_summary(fun.y = mean, geom = "point", shape=21, size=3, position = "dodge", colour = "black", alpha = 0.5) +
  ylab("\n \n \n \n \n \n \n Looking Time (s)") +
  xlab("Test Event")+
  coord_cartesian(ylim = c(0, 40)) +
  geom_point(alpha = 0.1)+
  geom_line(alpha = 0.1, aes(group = subj_id))+
  geom_errorbar(data = filter(summary.avg), size = .5, width = 0, aes(ymin=look-ci, ymax=look+ci)) +
  facet_grid(~experiment+training+goal+hab+causal+mitten)+
  scale_x_discrete(labels = c("ineff","eff"))+
  theme_bw(14)+
  scale_fill_ptol()+
  theme(legend.position="none", strip.text.x = element_blank())
```

```{r figS1b, fig.width = 20, fig.height=11, include=TRUE}
# prop looks ineff, grouped by experiment, with full variable info 
figS1.prop <- ggplot(data = dplyr::filter(lumi.prop.avg), aes(testtype, look, fill=experiment))
figS1.prop.full <- figS1.prop + 
  geom_boxplot(alpha = 0.5)+
  geom_violin(fill = NA, width = 0.5)+
  stat_summary(fun.y = mean, geom = "point", shape =21, size=3, position = "dodge", colour = "black", alpha = 0.5) +
  ylab("\n \n \n \n \n \n Proportion Looking \n to Inefficient") +
  xlab(element_blank())+
  geom_jitter(width = .05, alpha = 0.2)+
  coord_cartesian(ylim = c(0.2,0.8)) +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", colour="black", position = position_dodge(width = 5), width = 0) +
  geom_hline(yintercept=0.5, alpha=0.4)+
  facet_grid(~experiment+training+goal+hab+causal+mitten+stimuli)+
  theme_bw(14)+
  scale_fill_ptol()+
  theme(strip.placement = "outside") +
  theme(legend.position="none", axis.text.x = element_blank(), axis.title.x=element_blank())

# add annotations

grid.arrange(figS1.prop.full, figS1.raw.full, heights = c(0.5,0.5))

grid.text("Experiment", x = 0.07, y = 0.978)
grid.text("Motor training", x = 0.07, y = .95)
grid.text("Action relative to barrier", x = 0.07, y = 0.89)
grid.text("Goal", x = 0.07, y = .92)
grid.text("Action on contact", x = 0.07, y = 0.861)
grid.text("Actor wearing mitten", x = 0.07, y = 0.832)
grid.text("Displays", x = 0.07, y = 0.805)

```

**Figure S1**. Looking time in seconds towards the efficient versus inefficient reach (bottom), and proportion looking towards the inefficient reach (top) at test across Experiments 1-5 (n=152) and across Experiments 1-5 in Skerry et al. (SCS)32 (n=112). Labels above each panel list the experiment name (Exp. 1-5, SCS Exp. 1-5), type of motor training (none, ineffective non-sticky mittens, or effective sticky mittens), whether actions during habituation were constrained or unconstrained by a barrier, goal (state.change or pick.up), whether actions resulted in contact with the object, whether the actor wore a mitten, and video displays listed in Figure 1. Error bars around means indicate within-subjects 95% confidence intervals (bottom) and bootstrapped 95% confidence intervals (top). Individual points (top) or pairs of connected points (bottom) indicate data from a single participant. Horizontal bars within boxes indicate medians, and boxes indicate the middle 2 quartiles of data. Violin plots (top) indicate distribution of data, area scaled proportionally to the number of observations.



```{r meta_figure, include=TRUE, fig.width=12, fig.height = 8, cache=FALSE}
# two ways of plotting: first, plotting model effects
# plot_model(model1.all, sort.est=TRUE, show.values=TRUE, digits=3, colors = "bw",  title = "prop.ineff.all ~ training + hab + goal + mitten + causal + (1+first.test|experiment) + (1|ageday) + (1|sex) + (1|paper)")

# second, plotting model estimates for each level of categorical variable
plot(allEffects(model1.all.cooks),
     main = NA,
     ylim=c(0.37,0.63),
     ylab="Proportion Looks to Inefficient",
     ci.style="bars",
     lwd=4,
     grid=TRUE,
     colors={c("black", "red")}
)

```


**Figure S2.** Effect plots for model investigating predictors of sensitivity to action efficiency across Experiments 1-5 and Skerry et al. (2013) 32 (total N=264, 247 included in final analysis, 17 excluded on the basis of Cook’s Distance). Each point shows estimates of effects at each level of all categorical predictors: Type of motor training (none, ineffective non-sticky mittens, or effective sticky mittens), the goal of the actor (state change vs pick up), action during habituation (constrained or unconstrained by a barrier), whether actions resulted in contact with the object (yes or no), whether the actor wore a mitten (yes or no). Error bars indicate 95% confidence intervals. See Table S1 for full results.

***

***
**Table S1.** Regression table for model investigating predictors of sensitivity to action efficiency across Experiment 1-5 and all experiments from Skerry et al. (total N=`r length(unique(lumi.wide$subj_id))`, `r length(unique(lumi.wide$subj_id))-meta.exclude.n` included in final analysis, `r meta.exclude.n` excluded on the basis of Cook's Distance). Dependent measure is proportion looking towards the inefficient reach, averaged across 3 test trials during test. Categorical predictors were coded using sum contrasts, and fixed effects from the model should therefore be interpreted with respect to the grand mean (with respect to 0). Model formula: `prop.ineff.all ~ training + goal + hab + causal + mitten + (1|experiment) + (1|ageday) + (1|sex) + (1|paper)`.


```{r meta_table, include=TRUE}
kable(meta.findings, col.names = c("Standardized Estimate (ß)", "Estimate (B)", "Standard Error (SE)", "df", "t", "p", "95% CI (Lower)", "95% CI (Upper)"))

```


This analysis confirmed that first-person action experience is not the only way to enhance infants’ appreciation of the causal and intentional aspects of action. It also confirmed the findings from the individual experiments reported in the main text and from Skerry et al. (2013):  Infants’ expectations were stronger when the observed action was spatiotemporally continuous with its effect (i.e., appeared to be causal),`r report(meta.findings, 6, 3, 2)`, when infants received effective motor training (sticky mittens), relative to no training, `r report(meta.findings, 2, 3, 2)`, when the observed agent's actions were constrained by a barrier and were efficiently adapted to that barrier, relative to the same actions that were unconstrained by a barrier, `r report(meta.findings, 5, 3, 2)`, and when the agent pursued a state change goal, relative to a pickup goal, `r report(meta.findings, 4, 3, 2)`. We also found that infants’ expectations were marginally *negatively* affected when they received ineffective motor training (non-sticky mittens), relative to no training, `r report(meta.findings, 3, 3, 2)`, and were unaffected when the actor wore a mitten, relative to no mitten `r report(meta.findings, 7, 3, 2)`, as reported in the main text.



## Exclusion info

**Table S2.** Tally of infants who participated in Experiments 1-5 but were excluded in our final sample. These exclusion criteria vary slightly across experiments (e.g. we relaxed our definition of inattentiveness from excluding all data from a participant if they missed a test trial in Experiment 1, to excluding data from just that trial in Experiments 2-5).

Experiment | Fussiness | Inattentiveness | Caregiver Interference | Experimenter/Coding Error | Technical Failure | Total 
---------- | --------- | --------------- | ---------------------- | ------------------------- | ----------------- | -----
Exp.1 | 9 | 5 | 1 | 12 | 3 | 30
Exp.2 | 0 | 0 | 0 | 2 | 0 | 2
Exp.3 | 6 | 0 | 0 | 2 | 0 | 8
Exp.4 | 7 | 0 | 0 | 2 | 0 | 7
Exp.5 | 6 | 0 | 0 | 1 | 2 | 9
**Total** | 28 | 5 | 1 | 19 | 5 | 50
***


## Distribution of Looks

```{r distplot, fig.width = 7, include=TRUE}
# is a lognormal transformation justified given the distribution of looks?
fig.S2 <- ggplot(data = dplyr::filter(lumi.raw.avg), aes(look, fill=experiment, colour = experiment))
fig.S2 +
  geom_density(alpha = 0.5)+
  # geom_text(aes(experiment))+
  theme_linedraw(15)+
  xlab("Looking Time (s)")

normal.ll <- fitdistr(lumi.raw.avg$look, "normal")$loglik
lognormal.ll <- fitdistr(lumi.raw.avg$look, "lognormal")$loglik
```

**Figure S3.** Density plot of looking times during test across Experiments 1-5, and Experiments 1-5 from Skerry et al. (2013) (N=`r length(unique(lumi.wide$subj_id))`). Maximum-likelihood fitting revealed that the lognormal distribution (log likelihood=`r lognormal.ll`) provides a better fit to these data than the normal distribution (log likelihood=`r normal.ll`).

***

## Attention during habituation across Exp 1-5

```{r habplot, fig.width = 7, include=TRUE}
# habituation sum
hab.plot <- ggplot(data = filter(lumi.wide, paper == "LBS"), aes(experiment, total_hab, fill = experiment))
hab.plot + 
  geom_violin(alpha = 0.5, fill = NA)+
  geom_boxplot(alpha = 0.5, width = 0.5)+
  geom_jitter(width = .05, alpha = 0.2)+
  stat_summary(fun.y = mean, geom = "point", shape =21, size=3, position = "dodge", colour = "black") +
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", colour="black", size = .6, position = position_dodge(width = .9), width = 0.05) +
  xlab("Experiment") + ylab("Looking Time (s)") +
  coord_cartesian(ylim = c(0, 500)) +
  theme_linedraw(15)+
  theme(legend.position="none")
```

**Figure S4.** Total looking time in seconds during habituation across Experiment 1-5. Error bars around means indicate bootstrapped 95% confidence intervals (CIs). Individual points indicate data from a single participant. Horizontal bars within boxes indicate medians, and boxes indicate the middle 2 quartiles of data. Violin plots in indicate distribution of data, area scaled proportionally to the number of observations. 

***


```{r habplot2, fig.width = 12, include = TRUE}
lumi.hab <- lumi.wide %>% filter(paper == "LBS") %>% gather(habtrial, look, H1:H12)
lumi.hab$habtrial <- str_replace(lumi.hab$habtrial, "H", "")
lumi.hab$habtrial <- as.numeric(lumi.hab$habtrial)

habplot2 <- ggplot(data = lumi.hab, aes(x = habtrial, y = look, colour=experiment))
habplot2 +
  geom_point(alpha = 0.2) +
  geom_line(aes(group = subj_id), alpha = 0.2)+
  geom_smooth()+
  scale_x_continuous(breaks=c(1,3,6,9,12))+
  ylim(0, 45)+
  ylab("\n \n \n \n \n \n Looking Time (s)") +
  xlab("Habituation Trial (1-12)")+
  facet_grid(~experiment+goal+hab+causal+mitten+stimuli)+
  theme_bw(15)+
  theme(legend.position="none")

grid.text("Experiment", x = 0.08, y = 0.97)
grid.text("Goal", x = 0.08, y = 0.94)
grid.text("Action relative to barrier", x = 0.08, y = 0.91)
grid.text("Action on contact", x = 0.08, y = 0.88)
grid.text("Actor wearing mitten", x = 0.08, y = 0.85)
grid.text("Displays", x = 0.08, y = 0.82)

```

**Figure S5.** Looking time in seconds during each habituation trial across Experiments 1-5. Curves with 95% confidence interval ribbons indicate smoothed conditional means, generated using the loess method. Connected points indicate data from a single participant. Labels above each panel list the experiment name (Exp. 1-5), whether actions during habituation were constrained or unconstrained by a barrier, goal (state.change or pick.up), whether actions resulted in contact with the object, whether the actor wore a mitten, and video displays listed in Figure 1. 

```{r hab.analysis}

# assessing effect of experimental manipulations on hab time
op <- options(contrasts = c("contr.sum", "contr.poly"))
hab1 <- lmer(total_hab ~ ageday + sex + first.test + hab + goal + mitten + causal + (1|experiment), data = filter(lumi.wide, paper == "LBS"), REML=FALSE, control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)))
hab.table <- gen.m(hab1)
hab.ci <- gen.ci(hab1)[3:10,]

hab1.beta <- lmer(scale(total_hab) ~ scale(ageday) + sex + first.test + hab + goal + mitten + causal + (1|experiment), data = filter(lumi.wide, paper == "LBS"), REML=FALSE, control=lmerControl(optimizer="bobyqa", optCtrl=list(maxfun=2e5)))
hab.betas <- fixef(hab1.beta)

hab.findings <- data.frame(cbind(hab.betas,hab.table,hab.ci))
rownames(hab.findings) <- c("(Intercept)", "Age in Days", "Sex", "First Test Event", "Habituation", "Goal", "Mitten", "Causal")
names(hab.findings) <- c("beta", "b", "se", "df", "t", "p", "lower", "upper")

```

***

**Table S3** Regression table for mixed effects model analyzing the effect of age, sex, order of test events, habituation condition, goal, mitten, and causal information on total attention during habituation, controlling for variations across Experiments 1-5. Model formula: `total_hab ~ ageday + sex + first.test + hab + goal + mitten + causal + (1|experiment)`
```{r hab.table, include=TRUE}
kable(hab.findings, col.names = c("Standardized Estimate (ß)", "Estimate (B)", "Standard Error (SE)", "df", "t", "p", "95% CI (Lower)", "95% CI (Upper)"))
```

To ask whether infants’ total attention during habituation was affected by experimental manipulations across Experiment 1-5 (action constrained vs unconstrained by a barrier, state change vs pickup goal, mitten vs no mitten on actor, and action with vs without contact with the object), and varied by gender and age, we fit a mixed effects model on these fixed effects and experiment (Exp.1-5) as a random intercept. We found that the only robust predictor of attention during habituation was age, `r report(hab.findings, 2, 3, 2)`, such that older infants looked for a shorter time overall than younger infants.
